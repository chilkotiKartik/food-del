import e from"@babel/runtime/helpers/slicedToArray";import{createAction as t,createSlice as n,nanoid as r,combineReducers as i,configureStore as o}from"@reduxjs/toolkit";export{nanoid as itemid}from"@reduxjs/toolkit";import c,{useState as a,useCallback as u,useEffect as d,createContext as f,useRef as s,useMemo as l,useContext as p,forwardRef as v}from"react";import{useSelector as g,useDispatch as h,Provider as y,shallowEqual as b,batch as m}from"react-redux";import O from"@babel/runtime/helpers/defineProperty";import j from"@babel/runtime/helpers/toConsumableArray";import P,{enablePatches as w,produceWithPatches as x,original as I,applyPatches as D}from"immer";import E from"@babel/runtime/helpers/classCallCheck";import T from"@babel/runtime/helpers/createClass";import L from"@babel/runtime/helpers/typeof";import S from"lodash/toPath";import k from"lodash/clone";import _ from"@babel/runtime/helpers/extends";import B from"@babel/runtime/helpers/objectWithoutProperties";var C=function(e,t){return function(e,t){return e[t]}(e,t).history},A=function(e){return e.tree},M=function(e){return C(e,"tree")},N=function(e){return function(e,t){return C(e,"tree").present}(e)},R=function(e){return e.transfer};function H(e){return function(t,n){e(t.history.present,n)}}function U(t){return function(n,r){var i,o=x(n.history.present,(function(e){t(e,r)})),c=e(o,2)[1];n.batch.past=n.batch.past||P(I(n.history.present),(function(){})),(i=n.batch.patches).push.apply(i,j(c)),H(t)(n,r)}}function F(e){return function(t,n){U(e)(t,n)}}w(),w();var V=t("commitHistory");function Y(t,n){var r=t.batch,i=r.patches,o=x(r.past,(function(e){D(e,i)})),c=e(o,3),a=c[1],u=c[2],d=t.history.version+1>t.configuration.historyLimit;t.batch.patches=[],t.batch.past=null,0!==i.length&&a&&0!==a.length&&(t.history.timeline.length=t.history.version,d&&t.history.timeline.shift(),t.history.timeline.push({undo:u,redo:a}),t.history.version=t.history.timeline.length)}function X(e){return function(t,n){V(),Y(t),U(e)(t,n),Y(t)}}function W(e){return function(t,n){H(e)(t,n)}}var $=function(e){return 0!==e.history.version||e.batch.patches.length>0},q=function(e){return e.history.version!==e.history.timeline.length};function z(e){return"function"==typeof e}function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}w(),w();var K={commitHistory:Y},Q={redoHistory:function(e,t){var n=e.history,r=n.version,i=q(e);if(i&&i){var o=n.timeline[r].redo;e.history.version+=1,e.history.present=D(e.history.present,o)}},undoHistory:function(e,t){var n=e.history,r=n.version,i=$(e);if(i&&i){var o=n.timeline[r-1].undo;e.history.version-=1,e.history.present=D(e.history.present,o)}},restartHistory:function(e){e.history.version=0,e.history.timeline=[],e.batch.patches=[],e.batch.past=null},configureHistory:function(e,t){e.configuration.historyLimit=t.payload.configuration.historyLimit},configureBatchHistory:function(e,t){var n=t.payload.configuration;e.batch.configuration.batchTimeLimit=n.historyBatchTimeLimit,e.batch.configuration.batchTime=n.historyBatchTime}},Z=function(e){var t=e.initialTimeline,n=e.initialVersion,r=e.initialBatchTime,i=e.initialBatchTimeLimit,o=e.initialHistoryLimit;return{history:{version:void 0===n?0:n,present:e.initialState,timeline:void 0===t?[]:t},batch:{patches:[],configuration:{batchTime:void 0===r?3e3:r,batchTimeLimit:void 0===i?9e3:i},past:null},configuration:{historyLimit:void 0===o?9999999:o}}},ee=function(e){return String(Math.floor(Number(e)))===e},te=function(e){return!Number.isNaN(Number.parseFloat(e))};function ne(e){return"function"==typeof e}function re(e){return e}var ie=function(e){return null!==e&&"object"===L(e)},oe=function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=S(t);e&&r<i.length;)e=e[i[r++]];return void 0===e?n:e},ce=function(e,t,n){for(var r=k(e),i=r,o=0,c=S(t);o<c.length-1;o++){var a=c[o],u=oe(e,c.slice(0,o+1));if(u&&(ie(u)||Array.isArray(u)))i=i[a]=k(u);else{var d=c[o+1];i=i[a]=ee(d)&&Number(d)>=0?[]:{}}}return(0===o?e:i)[c[o]]===n?e:(void 0===n?delete i[c[o]]:i[c[o]]=n,0===o&&void 0===n&&delete r[c[o]],r)};function ae(e){return null!=e}function ue(e){return Object.keys(e)}function de(e){return Object.values(e)}function fe(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(!n.length)return e;var i=n.shift();return ie(e)&&ie(i)&&Object.keys(i).forEach((function(t){ie(i[t])?t in e?e[t]=ne(e[t])?function(){return fe(e[t].apply(e,arguments),i[t])}:fe(e[t],i[t]):Object.assign(e,O({},t,i[t])):ne(i[t])&&t in e?e[t]=ne(e[t])?function(){return fe(e[t].apply(e,arguments),i[t].apply(i,arguments))}:function(){return fe(e[t],i[t].apply(i,arguments))}:Object.assign(e,O({},t,i[t]))})),fe.apply(void 0,[e].concat(n))}function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var le=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];E(this,e),this.root=t,this.children=n}return T(e,[{key:"with_child",value:function(t){var n=[].concat(j(this.children),[t]);return new e(this.root,n)}}]),e}(),pe=function(){function e(t,n,r,i){E(this,e),this.detail=t,this.meta=n||{},this.indexes=r||[],this.indexes_list=i||[]}return T(e,[{key:"with_meta",value:function(t){return new e(this.detail,t,this.indexes,this.indexes_list)}},{key:"with_index",value:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return new e(this.detail,this.meta,[].concat(j(this.indexes),n),this.indexes_list)}},{key:"with_index_list",value:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return new e(this.detail,this.meta,this.indexes,[].concat(j(this.indexes_list),n))}}]),e}();function ve(e){return e instanceof le}function ge(e){return new le(e)}function he(e){return e instanceof pe}function ye(e){return new pe(e)}function be(e){function t(e,t){return e.byIds[t.id]=t.node,e.meta[t.id]=t.meta,t.index.forEach((function(n){e.index[n]=t.id})),t.index_list.forEach((function(n){e.index_list[n]=[].concat(j(e.index_list[n]||[]),[t.id])})),e}var n={root:null,byIds:{},meta:{},index:{},index_list:{}};if(!e.root)return n;var r=function(e,n){return e.root=n.id,t(e,n)}(n,me(e.root)),i=e.children.filter(he).reduce((function(e,n){return function(e,n){return n.node.parentId=e.root,e.byIds[e.root].childIds.push(n.id),t(e,n)}(e,me(n))}),r);return e.children.filter(ve).reduce((function(e,t){return function(e,t){return t.byIds[t.root].parentId=e.root,e.byIds[e.root].childIds.push(t.root),ue(t.byIds).forEach((function(n){e.byIds[n]=t.byIds[n]})),ue(t.meta).forEach((function(n){e.meta[n]=t.meta[n]})),ue(t.index).forEach((function(n){e.index[n]=t.index[n]})),ue(t.index_list).forEach((function(n){e.index_list[n]=[].concat(j(e.index_list[n]||[]),j(t.index_list[n]))})),e}(e,be(t))}),i)}function me(e){var t=r(),n=e.detail.__id__||t;return{id:n,node:{id:n,type:e.detail.type||null,props:e.detail.props||{},childIds:e.detail.childIds||[],parentId:e.detail.parentId||null},meta:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({id:n},e.meta),index:e.indexes,index_list:e.indexes_list}}function Oe(e){return ve(e)?be(e):e}var je=function(e,t){return e.byIds[t]},Pe=function(e,t){return je(e,je(e,t)&&je(e,t).parentId)},we=function(e,t){return e.meta[t]},xe=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(t,n){return t[n]=je(e,n),t}),{})},Ie=function(e,t){var n=function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=je(e,n);return i.childIds.reduce((function(e,n){var r=[].concat(j(e),[n]);return t(n,r)}),r)}(t);return xe.apply(void 0,[e].concat(j(n)))},De=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=xe.apply(void 0,[e].concat(n)),o=ue(i);return o.reduce((function(t,n){return t[n]=we(e,n),t}),{})},Ee=function(e,t){var n=ue(e.index).filter((function(n){return e.index[n]===t})),r=ue(e.index_list).filter((function(n){return e.index_list[n].includes(t)}));return[].concat(j(n),j(r)).sort()},Te=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=xe.apply(void 0,[e].concat(n)),o=ue(i);return o.reduce((function(t,n){return t[n]=Ee(e,n),t}),{})};function Le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ke,_e,Be,Ce,Ae,Me,Ne,Re,He,Ue=(_e=(ke={name:"tree",reducers:{createNode:{reducer:function(t,n){var r=n.payload,i=r.node,o=r.targetId,c=r.position,a=i.root,u=i.byIds[a],d=o,f=je(t,o).childIds,s=ae(c)?c:f.length;Object.entries(i.byIds).forEach((function(n){var r=e(n,2);t.byIds[r[0]]=r[1]})),t.byIds[o].childIds.splice(s,0,a),t.byIds[a]=Se(Se({},u),{},{parentId:d})}},deleteNode:{reducer:function(e,t){var n=t.payload.id,r=[].concat(j(ue(Ie(e,n))),[n]),i=Pe(e,n);if(r.forEach((function(t){e.root===t&&(e.root=null),delete e.byIds[t]})),i){var o=i.childIds.indexOf(n);e.byIds[i.id].childIds.splice(o,1)}}},intershiftNode:{reducer:function(e,t){var n=t.payload,r=n.id,i=n.absolute,o=n.relative,c=je(e,r),a=je(e,c.parentId),u=a.childIds,d=u.length,f=u.indexOf(r),s=ae(i)?i:ae(o)?f+o:d;e.byIds[a.id].childIds.splice(f,1),e.byIds[a.id].childIds.splice(s,0,r)}},moveNode:{reducer:function(e,t){var n=t.payload,r=n.id,i=n.targetId,o=n.position,c=Pe(e,r),a=je(e,i),u=c.childIds.indexOf(r),d=a.childIds,f=ae(o)?o:d.length;e.byIds[c.id].childIds.splice(u,1),e.byIds[i].childIds.splice(f,0,r),e.byIds[r].parentId=i}},replaceTree:{reducer:function(e,t){var n=t.payload.tree;e.root=n.root,e.byIds=n.byIds,e.meta=n.meta,e.index=n.index,e.index_list=n.index_list}},rewriteNode:{reducer:function(e,t){var n=t.payload,r=n.props;e.byIds[n.id].props=void 0===r?{}:r}},updateNode:{reducer:function(e,t){var n=t.payload,r=n.props;fe(e.byIds[n.id].props,void 0===r?{}:r)}},createMeta:{reducer:function(t,n){Object.entries(n.payload.meta).map((function(n){var r=e(n,2);t.meta[r[0]]=r[1]}))}},deleteMeta:{reducer:function(e,t){var n=t.payload.id;[].concat(j(ue(Ie(e,n))),[n]).forEach((function(t){delete e.meta[t]}))}},updateMeta:{reducer:function(e,t){var n=t.payload,r=n.meta;fe(e.meta[n.id],void 0===r?{}:r)}},createIndex:{reducer:function(t,n){var r=n.payload,i=r.index_list;Object.entries(r.index).forEach((function(n){var r=e(n,2);t.index[r[0]]=r[1]})),Object.entries(i).forEach((function(n){var r=e(n,2),i=r[0],o=r[1],c=t.index_list[i];c&&o.forEach((function(e){return t.index_list[i].push(e)})),c||(t.index_list[i]=o)}))}},deleteIndex:{reducer:function(e,t){var n=t.payload.id,r=[].concat(j(ue(Ie(e,n))),[n]),i=xe.apply(void 0,[e].concat(j(r)));Object.keys(e.index).forEach((function(t){i[e.index[t]]&&(e.index[t]=null)})),Object.keys(e.index_list).forEach((function(t){var n,r,o;r=function(e){return!i[e]},o=0,(n=e.index_list[t]).forEach((function(e,t){r.call(void 0,e,t,n)&&(t!==o&&(n[o]=e),o++)})),n.length=o}))}},addIndex:{reducer:function(e,t){var n=t.payload;e.index[n.name]=n.id}},removeIndex:{reducer:function(e,t){var n=t.payload,r=n.name,i=e.index[r];i&&i===n.id&&(e.index[r]=null)}},toggleIndex:{reducer:function(e,t){var n=t.payload,r=n.id,i=n.name,o=e.index[i],c=o&&o===r;c&&(e.index[i]=null),c||(e.index[i]=r)}},clearIndex:{reducer:function(e,t){e.index[t.payload.name]=null}},addListIndex:{reducer:function(e,t){var n=t.payload,r=n.id,i=n.name;e.index_list[i]=e.index_list[i]||[],e.index_list[i].push(r)}},removeListIndex:{reducer:function(e,t){var n=t.payload,r=n.name,i=e.index_list[r],o=i?i.indexOf(n.id):-1;o>=0&&e.index_list[r].splice(o,1)}},toggleListIndex:{reducer:function(e,t){var n=t.payload,r=n.id,i=n.name,o=e.index_list[i],c=o?o.indexOf(r):-1,a=c>=0;a&&e.index_list[i].splice(c,1),a||(e.index_list[i]=e.index_list[i]||[],e.index_list[i].push(r))}},clearListIndex:{reducer:function(e,t){e.index_list[t.payload.name]=[]}}}}).name,Be=ke.reducers,Ce=ke.extraReducers,Ae=Z({initialState:ke.initialState,initialBatchTime:ke.initialBatchTime,initialBatchTimeLimit:ke.initialBatchTimeLimit,initialHistoryLimit:ke.initialHistoryLimit,initialTimeline:ke.initialTimeline,initialVersion:ke.initialVersion}),Me=Object.entries(Be).reduce((function(t,n){var r=e(n,2),i=r[0],o=r[1];function c(e){for(var t=z(e)?e:e.reducer,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=r.reduce((function(e,t){return t(e)}),t);return z(e)?o:J(J({},e),{},{reducer:o})}var a="".concat(i,"/batched"),u="".concat(i,"/unbatched"),d="".concat(i,"/unrecorded");return t[a]=c(o,F),t[u]=c(o,X),t[d]=c(o,W),t[i]=o,t}),{}),Ne=Object.entries(Q).reduce((function(t,n){var r,i=e(n,2);return t[i[0]]=(r=i[1],function(e,t){V(),Y(e),r(e,t)}),t}),{}),Re=n({name:_e,initialState:Ae,reducers:J(J(J({},Me),K),Ne),extraReducers:Ce}),He=Object.entries(Re.actions).reduce((function(t,n){var r=e(n,2),i=r[1],o=r[0].split("/").reverse(),c=e(o,2),a=c[0];return t[a]&&(t[a][c[1]]=i),t}),{batched:{},unbatched:{},unrecorded:{}}),Re.extraActions=He,Re),Fe=Ue.extraActions.batched,Ve=Ue.extraActions.unbatched,Ye=Ue.extraActions.unrecorded,Xe=Ue.actions,We=Fe.createNode,$e=Fe.deleteNode,qe=Fe.intershiftNode,ze=Fe.moveNode,Ge=Fe.updateNode,Je=Fe.rewriteNode,Ke=Fe.createMeta,Qe=Fe.deleteMeta,Ze=Fe.updateMeta,et=Fe.createIndex,tt=Fe.deleteIndex,nt=Fe.addIndex,rt=Fe.removeIndex,it=Fe.toggleIndex,ot=Fe.clearIndex,ct=Fe.addListIndex,at=Fe.removeListIndex,ut=Fe.toggleListIndex,dt=Fe.clearListIndex,ft=Ve.intershiftNode,st=Ve.moveNode,lt=Ve.updateNode,pt=Ve.rewriteNode,vt=Ve.updateMeta,gt=Ve.addIndex,ht=Ve.removeIndex,yt=Ve.toggleIndex,bt=Ve.clearIndex,mt=Ve.addListIndex,Ot=Ve.removeListIndex,jt=Ve.toggleListIndex,Pt=Ve.clearListIndex,wt=Ye.createNode,xt=Ye.deleteNode,It=Ye.intershiftNode,Dt=Ye.moveNode,Et=Ye.updateNode,Tt=Ye.rewriteNode,Lt=Ye.createMeta,St=Ye.deleteMeta,kt=Ye.updateMeta,_t=Ye.createIndex,Bt=Ye.deleteIndex,Ct=Ye.addIndex,At=Ye.removeIndex,Mt=Ye.toggleIndex,Nt=Ye.clearIndex,Rt=Ye.addListIndex,Ht=Ye.removeListIndex,Ut=Ye.toggleListIndex,Ft=Ye.clearListIndex,Vt=Ye.replaceTree,Yt=Xe.undoHistory,Xt=Xe.redoHistory,Wt=Xe.restartHistory,$t=Xe.commitHistory,qt=function(){function e(t){E(this,e),this.running=t.running||!1,this.timeout=null,this.latest=t.latest,this.checkpoint=t.checkpoint,this.start=t.start}return T(e,[{key:"begin",value:function(){var e=Date.now();this.running=!0,this.start=e,this.checkpoint=e,this.latest=e}},{key:"mark",value:function(){var e=Date.now();this.running=!0,this.checkpoint=e,this.latest=e}},{key:"update",value:function(){var e=Date.now();this.latest=e}},{key:"withHandlers",value:function(e){this.handlers=e}},{key:"getDifference",value:function(){return this.latest-this.checkpoint}},{key:"getShort",value:function(){return this.latest-this.checkpoint}},{key:"getTotal",value:function(){return Date.now()-this.start}},{key:"getLong",value:function(){return Date.now()-this.latest}},{key:"isRunning",value:function(){return this.running}},{key:"run",value:function(e){var t=this;return this.millis=e.batchTime,this.maxMillis=e.batchTimeLimit,this.begin(),new Promise((function(e,n){t.timeout=setTimeout((function(){return t.finishLong()}),t.millis),t.withHandlers({resolve:function(t){e(t)},reject:function(e){n(e),clearTimeout(t.timeout)}})}))}},{key:"finish",value:function(){var e=this.getDifference(),t=this.getTotal();return(0===e||t>=this.maxMillis)&&(this.running=!1,this.timeout=null,this.handlers.resolve(),!0)}},{key:"finishLong",value:function(){var e=this;if(!this.finish()){var t=this.getShort();this.mark(),this.timeout=setTimeout((function(){return e.finishShort()}),t)}}},{key:"finishShort",value:function(){var e=this;if(!this.finish()){var t=this.millis-this.getLong();this.mark(),this.timeout=setTimeout((function(){return e.finishLong()}),t)}}},{key:"forceFinish",value:function(){this.running&&(this.handlers.resolve(),this.running=!1,this.timeout=null)}},{key:"abort",value:function(e){this.running&&(this.handlers.reject(e),this.running=!1,this.timeout=null)}}]),e}();function zt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zt(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Jt=f({batcher:{refresh:function(){},abort:function(){}},events:{addEventListener:function(){},removeEventListener:function(){}}});function Kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kt(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Zt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var en=function(){function t(e){return[te(e.clientX)?e.clientX:e.changedTouches?e.changedTouches[0].clientX:e.touches&&e.touches[0].clientX,te(e.clientY)?e.clientY:e.changedTouches?e.changedTouches[0].clientY:e.touches&&e.touches[0].clientY]}return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zt(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},{getEventClientCoords:t,getEventPosition:function(n){var r=t(n),i=e(r,2),o=i[0],c=i[1],a=n.currentTarget.getBoundingClientRect(),u=a.left+a.width/2,d=a.top+a.height/2;return{top:d>c,bottom:d<=c,left:u>o,right:u<=o}}})},tn=function(e){return e.data},nn=function(e){return e.meta};function rn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return on(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?on(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){a=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(a)throw o}}}}function on(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var cn=function(t){var n=t.listeners,r=g((function(e){return R(e)})),i=tn(r),o=Boolean(i),c=en();function a(e){return Object.defineProperty(e,"stopPropagation",{value:function(){e.__stopped=!0},configurable:!0}),Object.defineProperty(e,"isPropagationStopped",{value:function(){return e.__stopped},configurable:!0}),Object.defineProperty(e,"__stopped",{value:!1,configurable:!0,writable:!0}),e}function u(e,t){return Object.defineProperty(e,"currentTarget",{value:t,configurable:!0,writable:!0}),e}var f=s(null),l=s([]);function p(t){var n=c.getEventClientCoords(t),r=e(n,2);return document.elementsFromPoint(r[0],r[1])}function v(e,t){return(n.get(e)||{})[t]||[]}var h=function(e){return function(t){a(t);var n,r=rn(p(t));try{for(r.s();!(n=r.n()).done;){var i=n.value;if(t.isPropagationStopped())break;var o=v(i,e);0!==o.length&&(u(t,i),o.forEach((function(e){return e(t)})))}}catch(e){r.e(e)}finally{r.f()}}};function y(e){h("drop")(e)}function b(e){h("dragover")(e)}function m(e){!function(e){return function(t){a(e);var n,r=rn(p(e));try{for(r.s();!(n=r.n()).done;){var i=n.value,o=v(i,"dragenter");if(0!==o.length){if(t.current===i)return;if(t.current=i,e.isPropagationStopped())return;return u(e,i),void o.forEach((function(t){return t(e)}))}}}catch(e){r.e(e)}finally{r.f()}}}(e)(f)}function O(e){var t;(t="dragleave",function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return function(e){return function(r){a(e);var i=p(e),o=r.current;if(o){var c,d=!0,f=rn(i);try{for(f.s();!(c=f.n()).done;)if(c.value==o){d=!1;break}}catch(e){f.e(e)}finally{f.f()}var s,l=!1,g=rn(i);try{var h=function(){var e=s.value;return n.find((function(t){return v(e,t).length>0}))?(e===o||(l=!0),"break"):"continue"};for(g.s();!(s=g.n()).done;){var y=h();if("continue"!==y&&"break"===y)break}}catch(e){g.e(e)}finally{g.f()}if((d||l)&&(d&&(r.current=null),!e.isPropagationStopped())){var b=v(o,t);0!==b.length&&(u(e,o),b.forEach((function(t){return t(e)})))}}}}})("dragenter")(e)(f)}function j(e){!function(e){return function(t){a(e);var n,r=p(e),i=t.current,o=rn(r);try{for(o.s();!(n=o.n()).done;){var c=n.value;if(e.isPropagationStopped())break;var d=v(c,"dragin");0!==d.length&&(i.includes(c)||(u(e,c),d.forEach((function(t){return t(e)}))))}}catch(e){o.e(e)}finally{o.f()}t.current=r}}(e)(l)}function P(e){!function(e){return function(t){a(e);var n,r=p(e),i=rn(t.current);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(e.isPropagationStopped())break;var c=v(o,"dragout");0!==c.length&&(r.includes(o)||(u(e,o),c.forEach((function(t){return t(e)}))))}}catch(e){i.e(e)}finally{i.f()}}}(e)(l)}return d((function(){if(o)return document.addEventListener("dragover",O),document.addEventListener("dragover",P),document.addEventListener("dragover",j),document.addEventListener("dragover",m),document.addEventListener("dragover",b),document.addEventListener("drop",y),function(){document.removeEventListener("dragover",O),document.removeEventListener("dragover",P),document.removeEventListener("dragover",j),document.removeEventListener("dragover",m),document.removeEventListener("dragover",b),document.removeEventListener("drop",y)}}),[o,b,m,O,j,P,y]),d((function(){if(o)return document.addEventListener("touchmove",O),document.addEventListener("touchmove",P),document.addEventListener("touchmove",j),document.addEventListener("touchmove",m),document.addEventListener("touchmove",b),document.addEventListener("touchend",y),function(){document.removeEventListener("touchmove",O),document.removeEventListener("touchmove",P),document.removeEventListener("touchmove",j),document.removeEventListener("touchmove",m),document.removeEventListener("touchmove",b),document.removeEventListener("touchend",y)}}),[o,b,m,O,j,P,y]),d((function(){o||(f.current=null)}),[o]),d((function(){o||(l.current=[])}),[o]),null},an=function(t){var n,r,i=t.children,o=(n=g((function(e){return(t=A(e),t.batch).configuration;var t})),r=h(),function(t){var n=t.initialOnStart,r=void 0===n?function(){}:n,i=t.initialOnUpate,o=void 0===i?function(){}:i,c=t.initialOnFinish,f=void 0===c?function(){}:c,s=t.configuration,l=a(new qt({})),p=e(l,1)[0],v=a((function(){return r})),g=e(v,2),h=g[0],y=g[1],b=a((function(){return o})),m=e(b,2),O=m[0],j=m[1],P=a((function(){return f})),w=e(P,2),x=w[0],I=w[1],D=u((function(){p.run(s).then((function(){x()})).catch((function(){})),h()}),[p,h,x,s]),E=u((function(){p.update(),O()}),[p,O]),T=u((function(){p.running?E():D()}),[p,E,D]),L=u((function(){p.abort()}),[p]);d((function(){return L}),[L]);var S={refresh:T,abort:L};return Gt(Gt({},{setOnStart:y,setOnUpdate:j,setOnFinish:I}),S)}({initialOnFinish:function(){r($t({}))},configuration:n})),f=o.refresh,p=o.abort,v=function(){var e=s(new Map),t={addEventListener:u((function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n[0],o=n[1],c=n[2],a=e.current.get(i)||{},u=[].concat(j(a[o]||[]),[c]),d=Object.assign({},a,O({},o,u));e.current.set(i,d)}),[]),removeEventListener:u((function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n[0],o=n[1],c=n[2],a=e.current.get(i)||{},u=(a[o]||[]).filter((function(e){return e!==c})),d=Object.assign({},a,O({},o,u));e.current.set(i,d)}),[])};return Qt(Qt({},{listeners:e}),t)}(),y=v.listeners.current,b=v.addEventListener,m=v.removeEventListener,P=l((function(){return{batcher:{refresh:f,abort:p},events:{addEventListener:b,removeEventListener:m}}}),[f,p,b,m]);return c.createElement(Jt.Provider,{value:P},c.createElement(cn,{listeners:y}),i)},un=n({name:"transfer",initialState:{data:null,meta:null,type:null},reducers:{startTransfer:{reducer:function(e,t){var n=t.payload,r=n.meta,i=n.type;e.data=n.data,e.meta=r,e.type=i}},endTransfer:{reducer:function(e,t){e.data=null,e.meta=null,e.type=null}}}}),dn=un.actions,fn=dn.startTransfer,sn=dn.endTransfer,ln=i({tree:Ue.reducer,transfer:un.reducer}),pn=function(t){var n=t.children,r=function(e){var t=e.initialTimeline,n=e.initialVersion,r=e.initialHistoryLimit,i=e.initialBatchTime,o=e.initialBatchTimeLimit,c=Oe(e.initialTree||ge());return Z({initialState:c,initialTimeline:t,initialVersion:n,initialHistoryLimit:r,initialBatchTime:i,initialBatchTimeLimit:o})}({initialTree:t.initialTree,initialTimeline:t.initialTimeline,initialVersion:t.initialVersion,initialHistoryLimit:t.initialHistoryLimit,initialBatchTime:t.initialBatchTime,initialBatchTimeLimit:t.initialBatchTimeLimit}),i=a((function(){return o({reducer:ln,middleware:[],preloadedState:{tree:r}})})),u=e(i,1);return c.createElement(y,{store:u[0]},c.createElement(an,null,n))};function vn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var gn=function(e){return function(t){return je(N(t),e)}},hn=function(e){return function(t){return function(e,t){return de(e.byIds).find(t)}(N(t),e)}},yn=function(e){return function(t){return function(e,t){return je(e,t(e))}(N(t),e)}},bn=function(e){return function(t){return function(e,t){return e.byIds[e.index[t]]}(N(t),e)}},mn=function(e){return function(t){return Pe(N(t),e)}},On=function(){return function(e){return t=N(e),je(t,t.root);var t}},jn=function(e){var t=e.selector,n=(void 0===t?function(){}:t)({selectById:gn,selectByFilter:hn,selectByFinder:yn,selectByIndex:bn,selectParent:mn,selectRoot:On}),r=g(n),i=r&&r.id,o=g((function(e){return we(N(e),i)})),c=g((function(e){return Ee(N(e),i)}),b);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vn(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},{node:r,meta:o,indexes:new Proxy(c,{get:function(e,t){return e.includes(t)}})})},Pn=f(),wn=function(e){return c.createElement(Pn.Provider,{value:e.view},e.children)};function xn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function In(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xn(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Dn=function e(t){var n=t.id,r=t.view,i=t.shallow,o=t.childrenAs,a=void 0===o?e:o,u=t.filterProps,d=void 0===u?re:u,f=B(t,["id","view","shallow","childrenAs","filterProps"]),s=jn({selector:function(e){return e.selectById(n)}}).node,l=s.props,p=s.childIds,v=r[s.type],g=Boolean(v),h=a,y=d(In(In({},l),f));return g?c.createElement(v,_({},y,{id:s.id}),!i&&p.length>0?p.map((function(e){return c.createElement(h,_({key:e,id:e,view:r,childrenAs:a,filterProps:d},f))})):[]):null},En=function(e){var t=e.view,n=jn({selector:function(e){return e.selectRoot()}}).node;return n?c.createElement(wn,{view:t},c.createElement(Dn,{id:n.id,view:t})):null},Tn=function(e){var t=e.view,n=jn({selector:function(e){return e.selectByIndex("panel")}}).node||{},r=t[n.type];return r?c.createElement(r,{id:n.id}):null},Ln=function(){return p(Jt)},Sn=function(e){var t=s((function(){throw new Error("\n            Cannot call an event \n            handler while rendering.\n        ")}));return t.current=e,u((function(){return t.current.apply(t,arguments)}),[])},kn=c.forwardRef((function(t,n){var r=t.onDrop,i=t.onDragEnd,o=t.onDragOver,u=t.onDragStart,f=t.onDragEnter,l=t.onDragLeave,p=t.onDragIn,v=t.onDragOut,g=t.allowTouch,h=void 0===g||g,y=t.dragTouchTimeThreshold,b=void 0===y?200:y,O=t.isDragging,j=void 0!==O&&O,P=t.as,w=void 0===P?"div":P,x=B(t,["onDrop","onDragEnd","onDragOver","onDragStart","onDragEnter","onDragLeave","onDragIn","onDragOut","allowTouch","dragTouchTimeThreshold","isDragging","as"]),I=function(e){var t=s(e&&e.current);return d((function(){e&&("function"!=typeof e?e.current=t.current:e(t.current))})),t}(n),D=s(!1),E=a(!1),T=e(E,2),L=T[0],S=T[1],k=a(null),C=e(k,2),A=C[0],M=C[1];d((function(){I.current||console.warn("\n            Could not attach ref\n            to underlying DOM node.\n            You should allow ref\n            forwarding in underlying\n            node to attach listeners.\n        ")}),[I]);var N=Sn((function(e){e.stopPropagation(),L||(m((function(){return u(e)})),D.current=!0)})),R=Sn((function(e){e.stopPropagation(),m((function(){S(!0),M(e)}))})),H=Sn((function(e){Object.defineProperty(e,"currentTarget",{value:I.current,configurable:!0}),m((function(){S(!1),M(null),u(e)})),D.current=!0})),U=Sn((function(e){D.current&&(m((function(){return i(e)})),D.current=!1)})),F=Sn((function(e){D.current?(e.cancelable&&e.preventDefault(),setTimeout((function(){Object.defineProperty(e,"currentTarget",{value:I.current,configurable:!0}),m((function(){return i(e)})),D.current=!1}),0)):m((function(){S(!1),M(null)}))})),V=Sn((function(e){e.preventDefault()}));d((function(){if(I.current){var e=I.current;return u&&e.addEventListener("dragstart",N),i&&e.addEventListener("dragend",U),r&&e.addEventListener("dragover",V),function(){u&&e&&e.removeEventListener("dragstart",N),i&&e&&e.removeEventListener("dragend",U),r&&e&&e.removeEventListener("dragover",V)}}}),[I,u,i,r,N,U,V]),d((function(){if(I.current&&h){var e=I.current;return u&&e.addEventListener("touchstart",R),i&&e.addEventListener("touchend",F),function(){u&&e&&e.removeEventListener("touchstart",R),i&&e&&e.removeEventListener("touchend",F)}}}),[I,h,u,i,R,F]),d((function(){if(L){var e=setTimeout(H,b,A);return function(){return clearTimeout(e)}}}),[L,A,b,H]);var Y=Ln().events,X=Sn((function(e){m((function(){return o(e)}))})),W=Sn((function(e){m((function(){return f(e)}))})),$=Sn((function(e){m((function(){return l(e)}))})),q=Sn((function(e){m((function(){return p(e)}))})),z=Sn((function(e){m((function(){return v(e)}))})),G=Sn((function(e){m((function(){return r(e)}))}));return d((function(){if(j){var e=I.current;return o&&Y.addEventListener(e,"dragover",X),f&&Y.addEventListener(e,"dragenter",W),l&&Y.addEventListener(e,"dragleave",$),p&&Y.addEventListener(e,"dragin",q),v&&Y.addEventListener(e,"dragout",z),r&&Y.addEventListener(e,"drop",G),function(){o&&e&&Y.removeEventListener(e,"dragover",X),f&&e&&Y.removeEventListener(e,"dragenter",W),l&&e&&Y.removeEventListener(e,"dragleave",$),p&&e&&Y.removeEventListener(e,"dragin",q),v&&e&&Y.removeEventListener(e,"dragout",z),r&&e&&Y.removeEventListener(e,"drop",G)}}}),[Y,I,o,f,l,p,v,r,X,W,$,q,z,G,j]),c.createElement(w,_({},x,{ref:I}))})),_n=c.forwardRef((function(e,t){var n=e.listenAny,r=void 0!==n&&n,i=e.listenTransferType,o=B(e,["listenAny","listenTransferType"]),a=g((function(e){return R(e)})),u=tn(a);return c.createElement(kn,_({},o,{ref:t,isDragging:u&&(r||i===a.type)}))})),Bn=c.forwardRef((function(e,t){var n=_({},e);return c.createElement(_n,_({},n,{ref:t,listenTransferType:"builder"}))})),Cn=function(e){return v((function(t,n){return c.createElement(Bn,_({ref:n,as:e},t))}))};function An(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?An(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):An(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Nn=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return xe.apply(void 0,[N(e)].concat(t))}},Rn=function(e){return function(t){return function(e,t){return xe.apply(void 0,[e].concat(j(e.index_list[t]||[])))}(N(t),e)}},Hn=function(e){return function(t){return function(e,t){var n=e.byIds,r=ue(n).reduce((function(e,r){return t(n[r])&&e.push(r),e}),[]);return xe.apply(void 0,[e].concat(j(r)))}(N(t),e)}},Un=function(e){return function(t){return function(e,t){var n=t(e);return xe.apply(void 0,[e].concat(j(n)))}(N(t),e)}},Fn=function(e){return function(t){return function(e,t){for(var n=[],r=Pe(e,t);r;)n=[].concat(j(n),[r.id]),r=Pe(e,r.id);return xe.apply(void 0,[e].concat(j(n)))}(N(t),e)}},Vn=function(e){return function(t){return Ie(N(t),e)}},Yn=function(e){return function(t){return function(e,t){var n=je(e,t);return xe.apply(void 0,[e].concat(j(n.childIds)))}(N(t),e)}},Xn=function(e){var t=e.selector,n=(void 0===t?function(){}:t)({selectMultipleById:Nn,selectMultipleByIndex:Rn,selectMultipleByFilter:Hn,selectMultipleByFinder:Un,selectParents:Fn,selectChildren:Vn,selectDirectChildren:Yn}),r=g(n,b);function i(){return ue(r)}var o=g((function(e){return De.apply(void 0,[N(e)].concat(j(i())))}),b),c=g((function(e){return Te.apply(void 0,[N(e)].concat(j(i())))}),b),a={get:function(e,t){return e.includes(t)}},u=i().reduce((function(e,t){return e[t]=new Proxy(c[t],a),e}),{}),d={listIds:i,listNodes:function(){return de(r)},listMeta:function(){return de(o)}};return Mn(Mn({},{nodes:r,meta:o,indexes:u}),d)};function Wn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $n(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wn(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var zn=function(){var e=h(),t=Ln().batcher,n=function(){var e=h(),t={handleCreateBatched:function(t){var n=Oe(t.node);e(We({node:n,targetId:t.targetId,position:t.position})),e(Ke({meta:n.meta})),e(et({index:n.index,index_list:n.index_list}))},handleCreateUnrecorded:function(t){var n=Oe(t.node);e(wt({node:n,targetId:t.targetId,position:t.position})),e(Lt({meta:n.meta})),e(_t({index:n.index,index_list:n.index_list}))}};return $n($n({},{}),t)}(),r=function(){var e=h(),t={handleDeleteBatched:function(t){var n=t.id;e(Qe({id:n})),e(tt({id:n})),e($e({id:n}))},handleDeleteUnrecorded:function(t){var n=t.id;e(St({id:n})),e(Bt({id:n})),e(xt({id:n}))}};return $n($n({},{}),t)}(),i=function(e){return{targetId:e.targetId,id:e.id,position:e.position}},o=function(e){return{id:e.id,absolute:e.absolute,relative:e.relative}},c=function(e){var t=e.props,n=Object.keys(t).reduce((function(e,n){return ce(e,n,t[n])}),{});return{id:e.id,props:n}},a=function(e){var t=e.props,n=Object.keys(t).reduce((function(e,n){return ce(e,n,t[n])}),{});return{id:e.id,props:n}},u=function(e){var t=e.meta,n=Object.keys(t).reduce((function(e,n){return ce(e,n,t[n])}),{});return{id:e.id,meta:n}},d=function(e){return{id:e.id,name:e.name}},f=function(e){return{id:e.id,name:e.name}},s=function(e){return{id:e.id,name:e.name}},l=function(e){return{id:e.id,name:e.name}},p=function(e){return{id:e.id,name:e.name}},v=function(e){return{id:e.id,name:e.name}},g=function(e){return{name:e.name}},y=function(e){return{name:e.name}};return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qn(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},{timeBatched:{triggerCreate:function(e){n.handleCreateBatched(e),t.refresh()},triggerDelete:function(e){r.handleDeleteBatched(e),t.refresh()},triggerMove:function(n){e(ze(i(n))),t.refresh()},triggerShift:function(n){e(qe(o(n))),t.refresh()},triggerUpdate:function(n){e(Ge(c(n))),t.refresh()},triggerRewrite:function(n){e(Je(a(n))),t.refresh()},triggerMetaUpdate:function(n){e(Ze(u(n))),t.refresh()},triggerIndexAdd:function(n){e(nt(d(n))),t.refresh()},triggerIndexRemove:function(n){e(rt(s(n))),t.refresh()},triggerIndexToggle:function(n){e(it(p(n))),t.refresh()},triggerIndexClear:function(n){e(ot(g(n))),t.refresh()},triggerListIndexAdd:function(n){e(ct(f(n))),t.refresh()},triggerListIndexRemove:function(n){e(at(l(n))),t.refresh()},triggerListIndexToggle:function(n){e(ut(v(n))),t.refresh()},triggerListIndexClear:function(n){e(dt(y(n))),t.refresh()}},batched:{triggerCreate:function(e){t.abort(),n.handleCreateBatched(e)},triggerDelete:function(e){t.abort(),r.handleDeleteBatched(e)},triggerMove:function(n){t.abort(),e(ze(i(n)))},triggerShift:function(n){t.abort(),e(qe(o(n)))},triggerUpdate:function(n){t.abort(),e(Ge(c(n)))},triggerRewrite:function(n){t.abort(),e(Je(a(n)))},triggerMetaUpdate:function(n){t.abort(),e(Ze(u(n)))},triggerIndexAdd:function(n){t.abort(),e(nt(d(n)))},triggerIndexRemove:function(n){t.abort(),e(rt(s(n)))},triggerIndexToggle:function(n){t.abort(),e(it(p(n)))},triggerIndexClear:function(n){t.abort(),e(ot(g(n)))},triggerListIndexAdd:function(n){t.abort(),e(ct(f(n)))},triggerListIndexRemove:function(n){t.abort(),e(at(l(n)))},triggerListIndexToggle:function(n){t.abort(),e(ut(v(n)))},triggerListIndexClear:function(n){t.abort(),e(dt(y(n)))}},unbatched:{triggerCreate:function(r){t.abort(),n.handleCreateBatched(r),e($t({}))},triggerDelete:function(n){t.abort(),r.handleDeleteBatched(n),e($t({}))},triggerMove:function(n){t.abort(),e(st(i(n)))},triggerShift:function(n){t.abort(),e(ft(o(n)))},triggerUpdate:function(n){t.abort(),e(lt(c(n)))},triggerRewrite:function(n){t.abort(),e(pt(a(n)))},triggerMetaUpdate:function(n){t.abort(),e(vt(u(n)))},triggerIndexAdd:function(n){t.abort(),e(gt(d(n)))},triggerIndexRemove:function(n){t.abort(),e(ht(s(n)))},triggerIndexToggle:function(n){t.abort(),e(yt(p(n)))},triggerIndexClear:function(n){t.abort(),e(bt(g(n)))},triggerListIndexAdd:function(n){t.abort(),e(mt(f(n)))},triggerListIndexRemove:function(n){t.abort(),e(Ot(l(n)))},triggerListIndexToggle:function(n){t.abort(),e(jt(v(n)))},triggerListIndexClear:function(n){t.abort(),e(Pt(y(n)))}},unrecorded:{triggerCreate:function(e){n.handleCreateUnrecorded(e)},triggerDelete:function(e){r.handleDeleteUnrecorded(e)},triggerMove:function(t){e(Dt(i(t)))},triggerShift:function(t){e(It(o(t)))},triggerUpdate:function(t){e(Et(c(t)))},triggerRewrite:function(t){e(Tt(a(t)))},triggerMetaUpdate:function(t){e(kt(u(t)))},triggerIndexAdd:function(t){e(Ct(d(t)))},triggerIndexRemove:function(t){e(At(s(t)))},triggerIndexToggle:function(t){e(Mt(p(t)))},triggerIndexClear:function(t){e(Nt(g(t)))},triggerListIndexAdd:function(t){e(Rt(f(t)))},triggerListIndexRemove:function(t){e(Ht(l(t)))},triggerListIndexToggle:function(t){e(Ut(v(t)))},triggerListIndexClear:function(t){e(Ft(y(t)))}},history:{triggerCommit:function(){t.abort(),e($t({}))}}})};function Gn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Jn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gn(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Kn=function(t){var n=a(t.initialTransferType),r=e(n,2),i=r[0],o=r[1],c=h();function u(e){c(fn({data:e.data,meta:e.meta,type:i}))}var d={triggerDragStartCreate:function(e){var t=Jn({create:!0},e.meta||{});u({data:e.data,meta:t,type:i})},triggerDragStartMove:function(e){var t=Jn({create:!1},e.meta||{});u({data:e.data,meta:t,type:i})},triggerDragEnd:function(){c(sn({}))}};return Jn(Jn({},{transferType:i,setTransferType:o}),d)};function Qn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qn(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var er=function(e){var t=g((function(e){return R(e)})),n=en(),r=Boolean(t.data),i={getDnDEventPosition:function(e){return n.getEventPosition(e)},getDnDEventClientCoords:function(e){return n.getEventClientCoords(e)},getDragAndDrop:function(){return tn(t)?nn(t).create?(e=tn(t),n=nn(t),{transfer:e.byIds[e.root],meta:n}):{transfer:tn(t),meta:nn(t)}:null;var e,n}};return Zn(Zn({},{isTransfering:r,isTransferingType:r&&t.type===(e&&e.transferType)}),i)};function tr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function nr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tr(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var rr=function(e){var t=e.id,n=e.initialTransferType;d((function(){t||console.warn("\n            Did not received valid \n            id in DnD hook. \n            Please provide a valid\n            id to have predictable \n            behavior.\n        ")}),[t]);var r=jn({selector:function(e){return e.selectById(t)}}).node,i=Xn({selector:function(e){return e.selectParents(t)}}).nodes,o=g((function(e){return R(e)})),c=Kn({initialTransferType:n}),a=er({transferType:c.transferType}),u=zn();function f(e){c.triggerDragStartMove({data:r,meta:e.meta})}function s(){c.triggerDragEnd()}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=tn(o);if(n){var r=nn(o),i=r.create;i&&p(e,t),i||v(e,t)}}function p(e,n){var r=tn(o);u.timeBatched.triggerCreate({targetId:t,node:r,position:n}),e.stopPropagation()}function v(e,n){var r=tn(o);u.timeBatched.triggerMove({id:r.id,targetId:t,position:n}),e.stopPropagation()}function h(e){var n=a.getDragAndDrop();if(!n)return e;var r=n.transfer.id;return i[r]||r===t?void 0:e}var y={transferType:c.transferType,setTransferType:c.setTransferType},b={handleDrop:h(l),handleChildXDrop:h((function(e,t){l(e,t+(a.getDnDEventPosition(e).left?0:1))})),handleChildYDrop:h((function(e,t){l(e,t+(a.getDnDEventPosition(e).top?0:1))})),handleDragStart:function(e){f({}),e.stopPropagation()},handleDragEnd:function(){s()}},m={triggerDragStart:f,triggerDragEnd:s},O={toDnDHandler:h};return nr(nr(nr(nr(nr({},y),b),m),a),O)};function ir(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function or(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ir(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ir(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var cr=function(e){var t=e.id;d((function(){t||console.warn("\n            Did not received valid \n            id in editor hook. \n            Please provide a valid\n            id to have predictable \n            behavior.\n        ")}),[t]);var n=jn({selector:function(e){return e.selectById(t)}}),r=n.node&&n.node.props,i=n.meta,o=rr({initialTransferType:"builder",id:t}),c=zn();function a(e){var t=e.target,n=t.value,r=t.checked;switch(t.type){case"checkbox":return r;case"number":case"range":var i=Number.parseFloat(n);return te(i)?i:n;default:return n}}var u={props:r,meta:i},f=o.isTransferingType,s=B(o,["isTransfering","isTransferingType","transferType","setTransferType"]),l={handleUpdate:function(e,n){var r=e.target.name,i=a(e),o=oe(d,r),u=n&&z(n)?n(i,o):i,d=ce({},r,u);c.timeBatched.triggerUpdate({id:t,props:d})},handleMetaUpdate:function(e,n){var r=e.target.name,o=a(e),u=oe(i,r),d=n&&z(n)?n(o,u):o,f=ce({},r,d);c.timeBatched.triggerMetaUpdate({id:t,meta:f})},handlePanel:function(e){e.stopPropagation(),c.timeBatched.triggerIndexAdd({id:t,name:"panel"})}},p={isTransfering:f};return or(or(or(or({},u),s),l),p)};function ar(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ur(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ar(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ar(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var dr=function(e){var t=Kn({initialTransferType:e.initialTransferType});function n(){t.triggerDragEnd()}var r={handleDragEnd:function(){n()}},i={triggerDragStart:function(e){var n=Oe(e.data);t.triggerDragStartCreate({data:n,meta:e.meta})},triggerDragEnd:n};return ur(ur(ur({},{transferType:t.transferType,setTransferType:t.setTransferType}),r),i)},fr=function(){var e=dr({initialTransferType:"builder"});return B(e,["transferType","setTransferType"])};function sr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function lr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sr(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pr(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var gr=function(){var e,t,n=function(){var e=h(),t=g(M),n=Ln().batcher,r=g((function(e){return q(A(e))}),b),i={handleUndo:function(){n.abort(),e(Yt({}))},handleRedo:function(){n.abort(),e(Xt({}))}};return lr(lr({},{history:t,canUndo:g((function(e){return $(A(e))}),b),canRedo:r}),i)}(),r=(e=h(),t={handleReplace:function(t){var n=Oe(t.tree);e(Vt({tree:n})),e(Wt())}},$n($n({},{}),t)),i=n.history.present,o=Ln().batcher,c={json:function(){return i},loadTree:function(e){o.abort(),r.handleReplace({tree:e})}};return vr(vr(vr({},{}),n),c)},hr=function(){return p(Pn)};export{pn as Builder,Bn as DnDBuilder,Cn as DnDBuilderHOC,_n as DnDListener,Dn as Node,Tn as Panel,wn as ViewProvider,En as Workspace,ge as branch,ye as item,zn as useActions,gr as useBuilder,jn as useCollector,er as useDnDHelpers,cr as useEditor,Xn as useMultiCollector,rr as useNodeDnD,dr as useToolDnD,fr as useTools,hr as useView};
